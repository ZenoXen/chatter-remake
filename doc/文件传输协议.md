# 通用消息头

| 字段名称 | 类型     | 长度 | 描述                        |
|------|--------|----|---------------------------|
| 版本号  | int8   | 1  | 协议版本号                     |
| 消息类型 | int8   | 1  | 标识消息的类型                   |
| 会话id | string | 32 | 一个会话id代表一个文件任务，32位长度的uuid |
| 用户id | string | 32 | 发送该文件的用户id，32位长度的uuid     |
| 时间戳  | int64  | 8  | 消息发送的时间戳                  |
| 载荷长度 | int16  | 2  | 载荷的总字节数                   |
| 载荷   | bytes  |    | 实际承载的数据，长度为消息长度标识的        |

## 消息类型

* 0x01：FileTransferRequest，客户端计划发送文件给服务端的请求
* 0x02，FileTransferAcknowledgeResponse，服务端接受客户端文件的确认响应
* 0x03，FileChunkFetchRequest，服务端要从客户端获取文件块的请求
* 0x04，FileChunkFetchResponse，客户端发送文件块的响应
* 0x05，FileChunkFetchAcknowledgeResponse，服务端接收到文件块的确认响应

### FileTransferRequest

| 字段名称 | 类型     | 长度 | 描述      |
|------|--------|----|---------|
| 文件大小 | int64  | 8  | 文件大小字节数 |
| 文件名  | string |    | 完整文件名   |

### FileTransferAcknowledgeResponse

| 字段名称  | 类型      | 长度 | 描述       |
|-------|---------|----|----------|
| 确认时间戳 | int64   | 8  | 对方确认时间戳  |
| 是否接收  | boolean | 1  | 对方是否接收文件 |

### FileChunkFetchRequest

| 字段名称  | 类型    | 长度 | 描述                |
|-------|-------|----|-------------------|
| 文件块编号 | int32 | 4  | 本次要取的文件块编号，从0开始计数 |
| 文件块大小 | int16 | 2  | 本次要取的文件块大小        |

### FileChunkFetchResponse

| 字段名称   | 类型    | 长度 | 描述          |
|--------|-------|----|-------------|
| 文件块校验和 | bytes | 32 | 本次返回的文件块校验和 |
| 文件块数据  | bytes |    | 本次返回的文件字节数据 |

### FileChunkFetchAcknowledgeResponse

| 字段名称    | 类型    | 长度 | 描述                     |
|---------|-------|----|------------------------|
| 文件块编号   | int32 | 4  | 本次要取的文件块编号，从0开始计数      |
| 文件块大小   | int16 | 2  | 本次要取的文件块大小             |
| 已收取文件大小 | int64 | 8  | 已取的总文件大小，由之前收取的所有文件块相加 |
